<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>TV WALL - COMSATEL MONITORING</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        background: #1a1a1a;
        font-family: sans-serif;
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      #timer-bar {
        position: fixed;
        top: 0;
        left: 0;
        height: 4px;
        background: #00ff00;
        width: 0%;
        transition: width 0.1s linear;
        z-index: 9999;
      }
      #info {
        position: fixed;
        bottom: 10px;
        right: 10px;
        color: rgba(255, 255, 255, 0.3);
        font-size: 12px;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div id="timer-bar"></div>
    <div id="info">Cambiando en: <span id="countdown">30</span>s</div>
    <iframe id="dash-frame" src=""></iframe>

    <script>
      // ==========================================
      // CONFIGURACIÓN: Pega aquí tus URLs completas
      // ==========================================
      const DASHBOARD_URLS = [
        "http://127.0.0.1:8088/superset/dashboard/2/?native_filters_key=ZAekoSOBems",
        "http://127.0.0.1:8088/superset/dashboard/3/?native_filters_key=UDz7uXmwcCU",
        "http://127.0.0.1:8088/superset/dashboard/1/?native_filters_key=OmSbmwlyFsU",
      ];
      const ROTATION_TIME = 30; // Segundos

      let currentIndex = 0;
      let timeLeft = ROTATION_TIME;
      const frame = document.getElementById("dash-frame");
      const bar = document.getElementById("timer-bar");
      const countdown = document.getElementById("countdown");

      function updateSource() {
        let baseUrl = DASHBOARD_URLS[currentIndex];

        // Añadir parámetros de limpieza y visualización
        const separator = baseUrl.includes("?") ? "&" : "?";
        // standalone=2: oculta headers
        // embedded=true: mejora compatibilidad de iframe
        const finalUrl = `${baseUrl}${separator}standalone=2&embedded=true`;

        console.log("Cargando:", finalUrl);
        frame.src = finalUrl;

        currentIndex = (currentIndex + 1) % DASHBOARD_URLS.length;
        timeLeft = ROTATION_TIME;
      }

      function tick() {
        timeLeft--;
        countdown.innerText = timeLeft;
        bar.style.width =
          ((ROTATION_TIME - timeLeft) / ROTATION_TIME) * 100 + "%";

        if (timeLeft <= 0) {
          updateSource();
        }
      }

      // Iniciar
      updateSource();
      setInterval(tick, 1000);
    </script>
  </body>
</html>
