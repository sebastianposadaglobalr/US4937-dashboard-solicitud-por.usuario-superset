version: '2.2'

services:
  superset:
    build:
      context: .
      dockerfile: Dockerfile.superset
    container_name: superset_comsatel
    ports:
      - "8088:8088"
    environment:
      - SUPERSET_SECRET_KEY=comsatel_vip_2026
      - PYTHONPATH=/app/pythonpath
      - SUPERSET_CONFIG_PATH=/app/pythonpath/superset_config.py
    volumes:
      - ./superset_home:/app/superset_home
      - ./superset_config.py:/app/pythonpath/superset_config.py
    command: >
      bash -c "
      superset db upgrade;
      superset fab create-admin --username admin --firstname Superset --lastname Admin --email admin@superset.com --password admin || true;
      superset init;
      /usr/bin/run-server.sh --host 0.0.0.0 --port 8088 --workers 1 --timeout 60
      "
    restart: always

  cube:
    image: cubejs/cube:latest
    ports:
      - "4001:4000"
      - "15432:15432"
    env_file: .env
    volumes:
      - ./cube_model:/cube/conf
    restart: always
